version: '3'

tasks:
  build:
    sources:
      - index.pug
      - includes/*.pug
      - assets/scss/*.scss
    cmds:
      - yarn parcel build {{.TASKFILE_DIR}}/*.pug --dist-dir {{.TASKFILE_DIR}}/build --no-source-maps --no-optimize --public-url .

  dev:
    cmds:
      - yarn parcel {{.TASKFILE_DIR}}/index.pug --dist-dir {{.TASKFILE_DIR}}/dist

  public:
    deps: [build]
    sources:
      - build/*
    cmds:
      # - rm -r public/*
      - cp -r build/* public/
      - task: format
        vars: { SUB_DIR: public/ }

  deploy:
    deps: [public]
    cmds:
      - git subtree push --prefix public origin deploy

  setup_deploy:
    cmds:
      - git push origin deploy:deploy

  format:
    sources:
      - public/*.html
      - public/*.css
    cmds:
      - prettier {{.ROOT_DIR}}/{{.SUB_DIR}} --write --config ../../.prettierrc
