version: '3'

tasks:
  build:
    sources:
      - index.pug
      - includes/*.pug
      - assets/scss/*.scss
    cmds:
      - yarn parcel build {{.TASKFILE_DIR}}/*.pug --dist-dir {{.TASKFILE_DIR}}/dist --no-source-maps --no-optimize

  dev:
    cmds:
      - yarn parcel {{.TASKFILE_DIR}}/index.pug --dist-dir {{.TASKFILE_DIR}}/dist --no-source-maps

    # depends on setup - git branch deploy
  deploy:
    deps: [format_deploy]
    sources:
      - dist/*
    cmds:
      - git checkout deploy
      - mkdir -p public && touch public/deletme
      - rm -r public/*
      - cp -r dist/ public/
      - git add . && git commit -am "deploy qr-code-component"
      - git subtree push --prefix public origin deploy
      - git checkout main
      - git branch -D deploy

  format_deploy:
    deps: [build]
    sources:
      - public/*.html
      - public/*.css
    cmds:
      - yarn prettier {{.TASKFILE_DIR}}/public/*.html --write
      - yarn prettier {{.TASKFILE_DIR}}/public/*.css --write
